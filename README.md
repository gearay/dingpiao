# 12306 自动购票系统

一个基于Python的12306铁路票务自动预订系统，支持乘客信息管理、自动购票、定时购票等功能。

## 主要功能

### 1. 乘客信息管理
- 添加、编辑、删除乘客信息
- 支持身份证号、手机号、邮箱等信息
- 每个乘客可独立设置席次偏好（一等座、二等座、商务座等）
- 支持卧铺铺位选择（上铺、中铺、下铺）
- 乘客信息搜索功能

### 2. 车票信息管理
- 创建车票信息（车次、出发站、到达站、时间等）
- 为每个车票关联多个乘客
- 支持每个乘客选择不同的席次类型
- 车票信息搜索和筛选

### 3. 自动购票功能
- 基于Selenium的网页自动化
- 打开浏览器后由人工完成登录，避免验证码问题
- 自动化完成后续购票流程
- 支持多乘客不同席次的同时预订

### 4. 定时购票功能
- 支持设置定时购票任务
- 任务调度器管理多个预订任务
- 支持任务优先级设置
- 自动重试机制

### 5. 错误处理机制
- 智能错误识别和分类
- 用户可选择处理策略
- 详细的错误日志和统计
- 自动恢复建议

### 6. 系统设置
- 账号信息管理
- 重试参数配置
- 浏览器设置（有头/无头模式）
- 数据备份和恢复

## 系统架构

```
12306/
├── models.py           # 数据模型定义
├── ticket_manager.py   # 票务管理模块
├── auto_booking.py    # 自动购票模块
├── timed_booking.py   # 定时购票模块
├── error_handler.py   # 错误处理模块
├── main_app.py        # 主应用界面
├── main.py           # 程序入口
├── pyproject.toml    # 项目配置
└── README.md         # 说明文档
```

## 使用流程

### 1. 添加乘客信息
- 进入乘客管理
- 添加乘客并设置席次偏好

### 2. 创建车票信息
- 进入车票管理
- 输入列车信息并选择乘客

### 3. 自动购票
- 选择立即购票或预登录
- 程序打开浏览器，用户手动完成登录
- 登录成功后，程序自动完成后续购票流程

### 4. 定时购票
- 添加定时任务
- 设置开始时间
- 启动调度器

## 核心特性

### 人工登录 + 自动化操作
- 程序打开浏览器后，由用户完成登录操作
- 检测到登录成功后，自动进行后续的购票流程
- 避免了验证码处理的复杂性

### 多乘客独立席次选择
- 根据实际12306页面结构，每个乘客可以有不同的席次偏好
- 支持多种席次类型（一等座、二等座、商务座、硬卧、软卧等）
- 支持铺位选择（上铺、中铺、下铺）

### 智能错误处理
- 9种错误类型分类处理
- 用户可选择处理策略
- 详细的错误日志记录

## 安装和使用

### 环境要求
- Python 3.12+
- Chrome浏览器

### 安装依赖
```bash
pip install selenium>=4.15.0 webdriver-manager>=4.0.0
```

### 运行程序
```bash
python main.py
```

## 使用示例

### 基本使用流程
1. 启动程序：`python main.py`
2. 添加乘客信息（选择1）
3. 创建车票信息（选择2）
4. 立即购票（选择3）或定时购票（选择4）

### 自动购票流程
1. 选择车票信息
2. 程序打开浏览器，显示12306购票页面
3. 用户手动完成登录操作
4. 程序检测到登录成功后，自动完成：
   - 搜索车票
   - 选择车次
   - 选择乘客和席次
   - 提交订单
   - 确认订单

## 技术特点

### 浏览器自动化
- 使用Selenium WebDriver控制Chrome浏览器
- 避免被检测为自动化工具
- 支持窗口最大化

### 登录状态检测
- 多种方式检测用户登录状态
- 欢迎信息、用户名显示、退出按钮等
- 最多等待5分钟登录时间

### 完整的购票流程
- 自动填充搜索表单
- 智能席次选择
- 支持多乘客不同席次
- 完整的订单提交流程

## 注意事项

1. **合法使用**：请遵守12306网站的使用条款
2. **手动登录**：需要用户手动完成登录操作
3. **网络稳定性**：确保网络连接稳定
4. **账号安全**：妥善保管12306账号信息
5. **系统资源**：定时任务会占用系统资源

## 更新日志

### v0.2.0
- 重新设计自动购票流程，支持人工登录+自动化操作
- 优化登录状态检测机制
- 改进用户界面交互

### v0.1.0
- 初始版本发布
- 实现基本的乘客和车票管理
- 支持自动购票功能
- 实现定时购票系统
- 完善的错误处理机制

## 许可证

本项目仅供学习和研究使用，请勿用于商业用途。

---

**免责声明**：本工具仅供学习研究使用，使用者需自行承担使用风险，并遵守相关法律法规。